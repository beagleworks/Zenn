# 要件定義書

## はじめに

ブラウザで動作するテトリスゲームを開発します。このゲームは、クラシックなテトリスの基本的なゲームプレイを提供し、現代のWebブラウザで快適に動作することを目指します。プレイヤーは落下するテトロミノ（テトリスブロック）を操作して、水平ラインを完成させることでスコアを獲得します。

## 要件

### 要件1

**ユーザーストーリー:** プレイヤーとして、テトロミノを操作してゲームをプレイしたいので、基本的なゲーム操作ができる必要があります。

#### 受け入れ基準

1. プレイヤーが左矢印キーを押したとき、システムはテトロミノを左に1マス移動させる
2. プレイヤーが右矢印キーを押したとき、システムはテトロミノを右に1マス移動させる
3. プレイヤーが下矢印キーを押したとき、システムはテトロミノを下に1マス移動させる
4. プレイヤーが上矢印キーまたはスペースキーを押したとき、システムはテトロミノを時計回りに90度回転させる
5. テトロミノが他のブロックまたは境界と衝突する場合、システムは移動や回転を無効にする

### 要件2

**ユーザーストーリー:** プレイヤーとして、多様なブロックタイプでプレイしたいので、標準的なテトロミノに加えて小さなブロックも利用可能である必要があります。

#### 受け入れ基準

1. システムはI型テトロミノ（4マスの直線）を提供する
2. システムはO型テトロミノ（2x2の正方形）を提供する
3. システムはT型テトロミノ（T字型）を提供する
4. システムはS型テトロミノ（S字型）を提供する
5. システムはZ型テトロミノ（Z字型）を提供する
6. システムはJ型テトロミノ（J字型）を提供する
7. システムはL型テトロミノ（L字型）を提供する
8. システムはモノミノ（1マスの単体ブロック）を提供する
9. システムはドミノ（2マスの直線ブロック）を提供する
10. システムはトリオミノL型（3マスのL字型ブロック）を提供する
11. システムはトリオミノI型（3マスの直線ブロック）を提供する
12. 各ブロックタイプは異なる色で表示される

### 要件3

**ユーザーストーリー:** プレイヤーとして、ラインを完成させてスコアを獲得したいので、ライン消去機能が必要です。

#### 受け入れ基準

1. 水平ラインが完全に埋まったとき、システムはそのラインを消去する
2. ライン消去後、システムは上のブロックを下に落下させる
3. 1ライン消去時、システムは100ポイントを加算する
4. 2ライン同時消去時、システムは300ポイントを加算する
5. 3ライン同時消去時、システムは500ポイントを加算する
6. 4ライン同時消去時（テトリス）、システムは800ポイントを加算する

### 要件4

**ユーザーストーリー:** プレイヤーとして、ゲームの進行状況を把握したいので、スコアとレベルが表示される必要があります。

#### 受け入れ基準

1. システムは現在のスコアをリアルタイムで表示する
2. システムは現在のレベルを表示する
3. 10ライン消去ごとに、システムはレベルを1上げる
4. レベルが上がるとき、システムはテトロミノの落下速度を速くする
5. システムは消去したライン数の合計を表示する

### 要件5

**ユーザーストーリー:** プレイヤーとして、次に来るブロックを予測し、不要なブロックをスキップしたいので、プレビュー機能とスキップ機能が必要です。

#### 受け入れ基準

1. システムは次に落下するブロックをプレビューエリアに表示する
2. 現在のブロックが配置されたとき、システムは次のブロックを生成し、プレビューを更新する
3. プレビューエリアは現在のゲームフィールドとは別の場所に表示される
4. プレイヤーがスキップキー（Sキー）を押したとき、システムは現在プレビューされているブロックをスキップする
5. スキップ機能を使用するとき、システムはスキップスタックを1つ消費する
6. システムは最大4つのスキップスタックを保持する
7. 2ライン消去するごとに、システムはスキップスタックを1つ回復する
8. スキップスタックが0のとき、システムはスキップ操作を無効にする
9. システムは現在のスキップスタック数を表示する

### 要件6

**ユーザーストーリー:** プレイヤーとして、ゲームオーバー条件を理解したいので、明確なゲーム終了処理が必要です。

#### 受け入れ基準

1. 新しいテトロミノがゲームフィールドの上部に配置できないとき、システムはゲームオーバーを宣言する
2. ゲームオーバー時、システムは「Game Over」メッセージを表示する
3. ゲームオーバー時、システムは最終スコアを表示する
4. ゲームオーバー後、システムは新しいゲームを開始するオプションを提供する

### 要件7

**ユーザーストーリー:** プレイヤーとして、ゲームを一時停止したいので、ポーズ機能が必要です。

#### 受け入れ基準

1. プレイヤーがPキーまたはEscキーを押したとき、システムはゲームを一時停止する
2. ゲーム一時停止中、システムはテトロミノの落下を停止する
3. ゲーム一時停止中、システムは「Paused」メッセージを表示する
4. 一時停止中に再度Pキーを押したとき、システムはゲームを再開する

### 要件8

**ユーザーストーリー:** プレイヤーとして、快適にプレイしたいので、レスポンシブで視覚的に魅力的なインターフェースが必要です。

#### 受け入れ基準

1. システムは20行×10列のゲームフィールドを表示する
2. システムは各ブロックを明確に区別できる境界線で表示する
3. システムはゲームフィールドの背景を暗い色で表示する
4. システムは現在落下中のテトロミノを他の配置済みブロックと視覚的に区別する
5. システムはモバイルデバイスでも適切に表示される